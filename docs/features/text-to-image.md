# 文生图功能实现文档

## 功能概述

文生图功能允许用户通过输入文本描述（提示词）自动生成相应的图像。系统使用百炼云（DashScope）的AI文生图API服务，生成高质量的图像。

## 技术实现

文生图功能的实现分为以下几个部分：

1. **API路由**: 创建服务器端API路由处理与百炼云API的通信
2. **状态管理**: 使用自定义hook管理文生图的状态和请求流程
3. **UI组件**: 实现友好的用户界面，包括加载效果和错误处理

### API路由实现 (`app/api/text-to-image/route.ts`)

实现了两个主要端点：
- `POST`: 创建文生图任务，接收用户提示词，调用百炼云API创建异步任务
- `GET`: 查询任务结果，根据任务ID获取生成图像的URL

### 状态管理 (`components/hooks/use-text-to-image.ts`)

使用自定义hook管理文生图状态：
- 处理文生图任务的创建和结果轮询
- 管理加载状态和错误处理
- 提供简洁的接口供组件使用

### UI实现 (`components/client-page.tsx`)

- 提示词输入表单：用户输入描述并提交
- 加载效果：显示任务进度和状态变化
- 图片画廊：展示生成的图像和下载功能

## 配置说明

功能依赖以下配置：
- 百炼云API密钥：存储在`.env`文件中的`QWEN_API_KEY`变量
- 模型选择：使用`wanx2.1-t2i-plus`模型
- 图像参数：每次生成4张图像，尺寸为1024*1024像素

## 使用流程

1. 用户在输入框中输入文本描述
2. 点击"生成图像"按钮，系统创建文生图任务
3. 页面显示加载效果，系统轮询任务状态
4. 任务完成后，页面展示生成的4张图像
5. 用户可以下载或分享生成的图像

## 异常处理

系统处理以下异常情况：
- API请求失败
- 任务创建失败
- 任务执行失败
- 网络连接问题

当发生异常时，系统会显示友好的错误提示，并记录错误信息到控制台。

## 未来改进

可考虑以下改进方向：
- 支持更多图像参数的自定义（尺寸、数量等）
- 添加提示词模板和历史记录
- 实现图像保存到用户账户
- 添加更多生成模型的支持 